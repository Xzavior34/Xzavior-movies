<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicStream - React App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style type="text/tailwindcss">
        @layer base {
            /* Define a custom animation for the visualizer */
            @keyframes pulse-bar {
                0%, 100% {
                    transform: scaleY(0.5);
                }
                50% {
                    transform: scaleY(1);
                }
            }
            .animate-pulse {
                animation: pulse-bar 0.6s infinite alternate;
                transform-origin: bottom;
            }
        }

        /* Custom scrollbar styling to match the dark theme */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #121212;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #5e5e5e;
        }
    </style>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
</head>
<body class="bg-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // --- Functional Lucide Icon Components ---
        const LucideIcon = ({ children, size = 24, className = '', ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                {...props}
            >
                {children}
            </svg>
        );

        const Play = (props) => (<LucideIcon {...props}><polygon points="5 3 19 12 5 21 5 3"></polygon></LucideIcon>);
        const Pause = (props) => (<LucideIcon {...props}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></LucideIcon>);
        const SkipBack = (props) => (<LucideIcon {...props}><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></LucideIcon>);
        const SkipForward = (props) => (<LucideIcon {...props}><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></LucideIcon>);
        const Volume2 = (props) => (<LucideIcon {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></LucideIcon>);
        const Heart = (props) => (<LucideIcon {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5a5.5 5.5 0 0 0-5.5-5.5c-1.8 0-3.24.96-4.5 2.19C11.24 3.46 9.8 2.5 8 2.5A5.5 5.5 0 0 0 2.5 8c0 2.3.5 4.04 3 5.5l7 7Z"></path></LucideIcon>);
        const Search = (props) => (<LucideIcon {...props}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></LucideIcon>);
        const Home = (props) => (<LucideIcon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></LucideIcon>);
        const Library = (props) => (<LucideIcon {...props}><path d="m16 6 4 14"></path><path d="M12 6v14"></path><path d="M8 6L4 20"></path><path d="M22 18H2"></path></LucideIcon>);
        const Plus = (props) => (<LucideIcon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></LucideIcon>);
        const Menu = (props) => (<LucideIcon {...props}><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></LucideIcon>);
        const X = (props) => (<LucideIcon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></LucideIcon>);
        // ------------------------------------------------------------------------------------
        

        const MusicApp = () => {
          const [isPlaying, setIsPlaying] = useState(false);
          const [currentTrack, setCurrentTrack] = useState(null);
          const [progress, setProgress] = useState(0);
          const [duration, setDuration] = useState(0);
          const [volume, setVolume] = useState(70);
          const [activeView, setActiveView] = useState('home');
          const [searchQuery, setSearchQuery] = useState('');
          const [likedSongs, setLikedSongs] = useState(new Set());
          const [tracks, setTracks] = useState([]);
          const [loading, setLoading] = useState(true);
          const [menuOpen, setMenuOpen] = useState(false);
          const [usingMockData, setUsingMockData] = useState(false);
          const audioRef = useRef(null);

          const mockTracks = [
            { id: 'm1', title: "Blinding Lights", artist: { name: "The Weeknd" }, album: { title: "After Hours", cover_small: "https://via.placeholder.com/50/1DB954/FFFFFF?text=BL" }, duration: 200, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { id: 'm2', title: "Shape of You", artist: { name: "Ed Sheeran" }, album: { title: "÷ (Divide)", cover_small: "https://via.placeholder.com/50/FF5722/FFFFFF?text=SY" }, duration: 233, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { id: 'm3', title: "Dance Monkey", artist: { name: "Tones and I" }, album: { title: "The Kids Are Coming", cover_small: "https://via.placeholder.com/50/9C27B0/FFFFFF?text=DM" }, duration: 210, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { id: 'm4', title: "Levitating", artist: { name: "Dua Lipa" }, album: { title: "Future Nostalgia", cover_small: "https://via.placeholder.com/50/E91E63/FFFFFF?text=LV" }, duration: 203, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
            { id: 'm5', title: "Watermelon Sugar", artist: { name: "Harry Styles" }, album: { title: "Fine Line", cover_small: "https://via.placeholder.com/50/FF9800/FFFFFF?text=WS" }, duration: 174, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" },
            { id: 'm6', title: "Save Your Tears", artist: { name: "The Weeknd" }, album: { title: "After Hours", cover_small: "https://via.placeholder.com/50/3F51B5/FFFFFF?text=ST" }, duration: 215, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3" },
            { id: 'm7', title: "Good 4 U", artist: { name: "Olivia Rodrigo" }, album: { title: "SOUR", cover_small: "https://via.placeholder.com/50/F44336/FFFFFF?text=G4" }, duration: 178, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" },
            { id: 'm8', title: "Stay", artist: { name: "The Kid LAROI & Justin Bieber" }, album: { title: "Stay", cover_small: "https://via.placeholder.com/50/00BCD4/FFFFFF?text=ST" }, duration: 141, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
            { id: 'm9', title: "Heat Waves", artist: { name: "Glass Animals" }, album: { title: "Dreamland", cover_small: "https://via.placeholder.com/50/FF5722/FFFFFF?text=HW" }, duration: 238, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" },
            { id: 'm10', title: "Peaches", artist: { name: "Justin Bieber" }, album: { title: "Justice", cover_small: "https://via.placeholder.com/50/4CAF50/FFFFFF?text=PC" }, duration: 198, preview: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" },
          ];
          
          const DEEZER_CHART_URL = 'https://api.deezer.com/chart/0/tracks?limit=50';
          const DEEZER_SEARCH_URL = (query) => `https://api.deezer.com/search?q=${query}&limit=50`;
          const CORS_PROXY = 'https://api.allorigins.win/raw?url=';

          const fetchTracksFromDeezer = async (url) => {
              const proxiedUrl = CORS_PROXY + encodeURIComponent(url);
              const response = await fetch(proxiedUrl);
              
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }

              // Check if the response is valid JSON (Handles the '<HTML>' error)
              const text = await response.text();
              let data;
              try {
                  data = JSON.parse(text);
              } catch (e) {
                  throw new Error('Proxy returned non-JSON/HTML content.');
              }
              
              if (!data.data || data.data.length === 0) {
                  throw new Error('No track data found in response.');
              }
              
              const playableTracks = data.data.filter(t => t.preview);
              if (playableTracks.length < 5) { // Enforce a minimum for a good experience
                  throw new Error('Deezer response received, but too few tracks have a playable preview link.');
              }
              return playableTracks;
          };

          // Fetch tracks from Deezer API with fallback to mock data
          useEffect(() => {
            const fetchInitialTracks = async () => {
              try {
                setLoading(true);
                const fetchedTracks = await fetchTracksFromDeezer(DEEZER_CHART_URL);
                setTracks(fetchedTracks);
                setUsingMockData(false);
                console.log('✅ Deezer API loaded successfully:', fetchedTracks.length, 'tracks');
              } catch (error) {
                console.warn(`⚠️ Deezer API failed, using mock data: ${error.message}`);
                setTracks(mockTracks);
                setUsingMockData(true);
              } finally {
                setLoading(false);
              }
            };
            fetchInitialTracks();
          }, []);

          // Search Deezer API or mock data
          const searchTracks = async (query) => {
            if (!query.trim()) {
              // Reset to original/chart tracks
              if (usingMockData) {
                setTracks(mockTracks);
              } else {
                try {
                  const fetchedTracks = await fetchTracksFromDeezer(DEEZER_CHART_URL);
                  setTracks(fetchedTracks);
                } catch (error) {
                  setTracks(mockTracks); 
                  setUsingMockData(true);
                }
              }
              return;
            }
            
            if (usingMockData) {
              // Search in mock data
              const filtered = mockTracks.filter(track =>
                track.title.toLowerCase().includes(query.toLowerCase()) ||
                track.artist.name.toLowerCase().includes(query.toLowerCase())
              );
              setTracks(filtered);
            } else {
              try {
                const fetchedTracks = await fetchTracksFromDeezer(DEEZER_SEARCH_URL(query));
                setTracks(fetchedTracks);
              } catch (error) {
                console.error('Search failed:', error);
                const filtered = mockTracks.filter(track =>
                  track.title.toLowerCase().includes(query.toLowerCase()) ||
                  track.artist.name.toLowerCase().includes(query.toLowerCase())
                );
                setTracks(filtered);
                setUsingMockData(true);
              }
            }
          };

          useEffect(() => {
            const delaySearch = setTimeout(() => {
              if (activeView === 'search') {
                searchTracks(searchQuery);
              }
            }, 500);
            return () => clearTimeout(delaySearch);
          }, [searchQuery, activeView]);

          // Audio controls
          useEffect(() => {
            const audio = audioRef.current;
            if (!audio) return;

            const updateProgress = () => {
              if (audio.duration && isFinite(audio.duration)) {
                setProgress((audio.currentTime / audio.duration) * 100);
                setDuration(audio.duration);
              }
            };

            const handleEnded = () => {
              const currentIndex = tracks.findIndex(t => t.id === currentTrack?.id);
              if (currentIndex !== -1 && currentIndex < tracks.length - 1) {
                  skipTrack('next');
              } else {
                  setIsPlaying(false);
                  setProgress(0);
              }
            };

            const handlePlay = () => setIsPlaying(true);
            const handlePause = () => setIsPlaying(false);
            const handleError = (e) => {
              console.error('Audio playback error:', e);
              setIsPlaying(false);
            };

            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('ended', handleEnded);
            audio.addEventListener('loadedmetadata', updateProgress);
            audio.addEventListener('play', handlePlay);
            audio.addEventListener('pause', handlePause);
            audio.addEventListener('error', handleError);


            return () => {
              audio.removeEventListener('timeupdate', updateProgress);
              audio.removeEventListener('ended', handleEnded);
              audio.removeEventListener('loadedmetadata', updateProgress);
              audio.removeEventListener('play', handlePlay);
              audio.removeEventListener('pause', handlePause);
              audio.removeEventListener('error', handleError);
            };
          }, [currentTrack, tracks]); 

          useEffect(() => {
            const audio = audioRef.current;
            if (audio) {
              audio.volume = volume / 100;
            }
          }, [volume]);

          const togglePlay = () => {
            const audio = audioRef.current;
            if (!audio || !currentTrack) return;

            if (isPlaying) {
              audio.pause();
            } else {
              audio.play().catch(e => {
                console.error('Playback error:', e);
                setIsPlaying(false);
                alert("Playback failed. The browser may be blocking autoplay. Please try playing a different track.");
              });
            }
          };

          const playTrack = (track) => {
            const audio = audioRef.current;
            if (!audio) return;

            if (track.id === currentTrack?.id) {
                togglePlay();
                return;
            }

            setCurrentTrack(track);
            setProgress(0);
            
            audio.volume = volume / 100;
            audio.pause();
            audio.src = track.preview;
            audio.load();
            
            audio.play().catch(e => {
              console.error('Initial playback failed:', e);
              setIsPlaying(false);
              alert("Playback failed. The browser may be blocking autoplay or the audio file format is unsupported. Please click the play button.");
            });
          };

          const toggleLike = (trackId) => {
            setLikedSongs(prev => {
              const newSet = new Set(prev);
              if (newSet.has(trackId)) {
                newSet.delete(trackId);
              } else {
                newSet.add(trackId);
              }
              return newSet;
            });
          };

          const skipTrack = (direction) => {
            if (!currentTrack || tracks.length === 0) return;
            const currentIndex = tracks.findIndex(t => t.id === currentTrack.id);
            if (currentIndex === -1) return;

            let nextIndex;
            if (direction === 'next') {
              nextIndex = (currentIndex + 1) % tracks.length;
            } else {
              nextIndex = currentIndex - 1 < 0 ? tracks.length - 1 : currentIndex - 1;
            }
            playTrack(tracks[nextIndex]);
          };

          const seekTo = (e) => {
            const audio = audioRef.current;
            if (!audio || !audio.duration || !isFinite(audio.duration)) return;
            
            const rect = e.currentTarget.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = x / rect.width;
            
            const newTime = audio.duration * percentage;
            if (newTime >= 0 && newTime <= audio.duration) {
                audio.currentTime = newTime;
            }
          };

          const formatTime = (seconds) => {
            if (!seconds || isNaN(seconds) || !isFinite(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };
          
          // Component for the Profile/Xzavior Button
          const ProfileButton = () => (
            <button 
                onClick={() => setMenuOpen(!menuOpen)}
                className="flex items-center space-x-2 bg-black rounded-full p-1.5 pr-3 hover:bg-gray-800 transition-colors cursor-pointer"
            >
                <div className="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center font-bold text-lg text-white">
                    X
                </div>
                <span className="font-semibold text-sm">Xzavior</span>
            </button>
          );
          
          // Component for the Top Navigation Bar
          const TopNav = () => (
              <div className="flex justify-between items-center py-4 px-4 lg:px-8 bg-gray-900/90 backdrop-blur-md sticky top-0 z-10">
                  {/* Left: Menu/Back Button (Visible on Mobile) */}
                  <button
                    onClick={() => setMenuOpen(!menuOpen)}
                    className="lg:hidden text-gray-400 hover:text-white"
                  >
                    {menuOpen ? <X size={24} /> : <Menu size={24} />}
                  </button>

                  {/* Center: Profile Button (Visible on Desktop/Default Position on Mobile) */}
                  <div className="hidden lg:block">
                      <ProfileButton />
                  </div>
                  
                  {/* Right: Profile Button for Mobile View */}
                  <div className="lg:hidden">
                      <ProfileButton />
                  </div>
              </div>
          );

          // Component for the Sidebar
          const Sidebar = () => (
            <div className={`
                ${menuOpen ? 'translate-x-0' : '-translate-x-full'}
                lg:translate-x-0 transition-transform duration-300 ease-in-out
                fixed lg:static inset-y-0 left-0 z-40
                w-64 bg-black p-4 lg:p-6 flex flex-col
                border-r border-gray-800
                bg-black-900
                lg:flex-shrink-0
            `}>
                <h1 className="text-xl lg:text-2xl font-bold mb-6 lg:mb-8 text-green-500 mt-12 lg:mt-0">MusicStream</h1>
                
                <nav className="space-y-2 lg:space-y-4 mb-6 lg:mb-8">
                    {['home', 'search', 'library', 'liked'].map(view => {
                        const Icon = view === 'home' ? Home : view === 'search' ? Search : view === 'library' ? Library : Heart;
                        const label = view === 'liked' ? 'Liked Songs' : view.charAt(0).toUpperCase() + view.slice(1);
                        return (
                            <button
                                key={view}
                                onClick={() => {
                                    setActiveView(view);
                                    setMenuOpen(false);
                                }}
                                className={`flex items-center gap-3 lg:gap-4 w-full p-2 rounded ${activeView === view ? 'bg-gray-800 text-white' : 'text-gray-400 hover:text-white hover:bg-gray-900'}`}
                            >
                                <Icon size={20} className={view === 'liked' ? 'text-purple-500' : ''} />
                                <span className="font-semibold text-sm lg:text-base">{label}</span>
                            </button>
                        );
                    })}
                </nav>

                <div className="border-t border-gray-800 pt-4">
                    <button className="flex items-center gap-3 lg:gap-4 w-full p-2 text-gray-400 hover:text-white hover:bg-gray-900 rounded mb-3 lg:mb-4">
                        <Plus size={20} />
                        <span className="font-semibold text-sm lg:text-base">Create Playlist</span>
                    </button>
                </div>
            </div>
          );


          return (
            <div className="flex flex-col h-screen bg-black text-white overflow-hidden">
              <audio ref={audioRef} crossOrigin="anonymous" />
              
              <div className="flex flex-1 overflow-hidden">
                
                <Sidebar />

                {/* Overlay for mobile menu */}
                {menuOpen && (
                    <div
                        className="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30"
                        onClick={() => setMenuOpen(false)}
                    />
                )}

                {/* Main Content Area */}
                <div className="flex-1 flex flex-col bg-gradient-to-b from-gray-900 to-black overflow-hidden">
                    
                    <TopNav />

                    <div className="flex-1 overflow-y-auto custom-scroll p-4 lg:p-8 pb-32">
                        {activeView === 'search' && (
                            <div className="mb-4 lg:mb-6">
                                <div className="relative w-full max-w-lg">
                                    <Search className="absolute left-3 top-3 text-gray-400" size={20} />
                                    <input
                                        type="text"
                                        placeholder="Search songs, artists..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full bg-gray-800 rounded-full py-3 pl-12 pr-4 text-sm lg:text-base text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"
                                    />
                                </div>
                            </div>
                        )}

                        <div className="mb-6 lg:mb-8">
                            <h2 className="text-2xl lg:text-3xl font-bold mb-4 lg:mb-6">
                                {activeView === 'home' ? 'Popular Tracks' : 
                                 activeView === 'search' ? 'Search Results' : 
                                 activeView === 'liked' ? 'Liked Songs' : 'Your Library'}
                            </h2>

                            {loading ? (
                                <div className="text-center py-12">
                                    <div className="inline-block w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin"></div>
                                    <p className="text-gray-400 mt-4">Loading tracks...</p>
                                    {usingMockData && <p className="text-yellow-500 text-sm mt-2">Using mock data due to API/Proxy failure.</p>}
                                </div>
                            ) : tracks.length === 0 ? (
                                <div className="text-center py-12 text-gray-400">
                                    {activeView === 'liked' ? 'No liked songs yet' : 'No tracks found'}
                                </div>
                            ) : (
                                <div className="space-y-1 lg:space-y-2">
                                    {(activeView === 'liked' 
                                        ? tracks.filter(t => likedSongs.has(t.id))
                                        : tracks
                                    ).map((track, index) => (
                                        <div
                                            key={track.id}
                                            className={`grid grid-cols-12 gap-2 lg:gap-4 p-2 lg:p-3 rounded hover:bg-gray-800 cursor-pointer transition-colors ${
                                                currentTrack?.id === track.id ? 'bg-gray-800' : ''
                                            }`}
                                            onClick={() => playTrack(track)}
                                        >
                                            <div className="col-span-1 flex items-center justify-center">
                                                {currentTrack?.id === track.id && isPlaying ? (
                                                    <div className="flex gap-0.5">
                                                        <div className="w-0.5 h-3 bg-green-500 animate-pulse"></div>
                                                        <div className="w-0.5 h-3 bg-green-500 animate-pulse" style={{animationDelay: '0.2s'}}></div>
                                                        <div className="w-0.5 h-3 bg-green-500 animate-pulse" style={{animationDelay: '0.4s'}}></div>
                                                    </div>
                                                ) : (
                                                    <span className="text-xs lg:text-sm text-gray-400">{index + 1}</span>
                                                )}
                                            </div>
                                            <div className="col-span-8 lg:col-span-6 flex items-center gap-2 lg:gap-3 min-w-0">
                                                <img 
                                                    src={track.album?.cover_small || track.artist?.picture_small || 'https://via.placeholder.com/50/1DB954/FFFFFF?text=♪'} 
                                                    alt={track.title}
                                                    className="w-10 h-10 lg:w-12 lg:h-12 rounded flex-shrink-0 object-cover"
                                                    onError={(e) => { e.target.src = 'https://via.placeholder.com/50/1DB954/FFFFFF?text=♪'; }}
                                                />
                                                <div className="min-w-0 flex-1">
                                                    <div className={`font-medium text-sm lg:text-base truncate ${currentTrack?.id === track.id ? 'text-green-500' : ''}`}>
                                                        {track.title}
                                                    </div>
                                                    <div className="text-xs lg:text-sm text-gray-400 truncate">{track.artist?.name}</div>
                                                </div>
                                            </div>
                                            <div className="col-span-2 lg:col-span-4 hidden lg:flex items-center text-gray-400 text-sm truncate">
                                                {track.album?.title}
                                            </div>
                                            <div className="col-span-2 lg:col-span-1 flex items-center justify-end gap-2">
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        toggleLike(track.id);
                                                    }}
                                                    className="hover:scale-110 transition-transform"
                                                >
                                                    <Heart
                                                        size={16}
                                                        className={likedSongs.has(track.id) ? 'fill-green-500 text-green-500' : 'text-gray-400'}
                                                    />
                                                </button>
                                                <span className="text-xs text-gray-400 hidden sm:block">{formatTime(track.duration)}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Player - Fixed at bottom */}
                    <div className="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 p-3 lg:p-4 z-20">
                        <div className="flex flex-col gap-2">
                            {/* Progress bar */}
                            <div 
                                className="w-full bg-gray-700 h-1 rounded-full overflow-hidden cursor-pointer"
                                onClick={seekTo}
                            >
                                <div
                                    className="bg-green-500 h-full"
                                    style={{ width: `${progress}%`, transition: 'width 0.1s linear' }}
                                />
                            </div>

                            <div className="flex items-center justify-between gap-2 lg:gap-4">
                                {/* Track Info & Timer */}
                                <div className="flex items-center gap-2 lg:gap-3 flex-1 min-w-0">
                                    <span className="text-xs text-gray-400 hidden sm:block w-8 text-right">{formatTime(audioRef.current?.currentTime)}</span>
                                    {currentTrack ? (
                                        <>
                                            <img 
                                                src={currentTrack.album?.cover_small || currentTrack.artist?.picture_small || 'https://via.placeholder.com/56/1DB954/FFFFFF?text=♪'} 
                                                alt={currentTrack.title}
                                                className="w-12 h-12 lg:w-14 lg:h-14 rounded flex-shrink-0 object-cover"
                                                onError={(e) => { e.target.src = 'https://via.placeholder.com/56/1DB954/FFFFFF?text=♪'; }}
                                            />
                                            <div className="min-w-0 flex-1">
                                                <div className="font-medium text-sm lg:text-base truncate">{currentTrack.title}</div>
                                                <div className="text-xs lg:text-sm text-gray-400 truncate">{currentTrack.artist?.name}</div>
                                            </div>
                                            <button
                                                onClick={(e) => { e.stopPropagation(); toggleLike(currentTrack.id); }}
                                                className="flex-shrink-0 hidden sm:block"
                                            >
                                                <Heart
                                                    size={18}
                                                    className={likedSongs.has(currentTrack.id) ? 'fill-green-500 text-green-500' : 'text-gray-400 hover:text-white'}
                                                />
                                            </button>
                                        </>
                                    ) : (
                                        <div className="text-xs lg:text-sm text-gray-400">No track selected</div>
                                    )}
                                    <span className="text-xs text-gray-400 hidden sm:block w-8 text-left">{formatTime(duration)}</span>
                                </div>


                                {/* Controls */}
                                <div className="flex items-center gap-2 lg:gap-4 flex-shrink-0">
                                    <button
                                        onClick={() => skipTrack('prev')}
                                        className="text-gray-400 hover:text-white transition-colors"
                                        disabled={!currentTrack}
                                    >
                                        <SkipBack size={20} className="lg:w-6 lg:h-6" />
                                    </button>
                                    <button
                                        onClick={togglePlay}
                                        disabled={!currentTrack}
                                        className="w-8 h-8 lg:w-10 lg:h-10 bg-white rounded-full flex items-center justify-center hover:scale-105 transition-transform disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0"
                                    >
                                        {isPlaying ? 
                                            <Pause size={18} className="lg:w-6 lg:h-6 text-black" /> : 
                                            <Play size={18} className="lg:w-6 lg:h-6 text-black ml-0.5" />
                                        }
                                    </button>
                                    <button
                                        onClick={() => skipTrack('next')}
                                        className="text-gray-400 hover:text-white transition-colors"
                                        disabled={!currentTrack}
                                    >
                                        <SkipForward size={20} className="lg:w-6 lg:h-6" />
                                    </button>
                                </div>

                                {/* Volume - Desktop only */}
                                <div className="hidden lg:flex items-center gap-2 flex-shrink-0">
                                    <Volume2 size={20} className="text-gray-400" />
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={volume}
                                        onChange={(e) => setVolume(e.target.value)}
                                        className="w-20 accent-green-500 cursor-pointer"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {/* Mobile Navigation (Bottom Bar - always visible) */}
            <div className="lg:hidden fixed bottom-0 left-0 right-0 bg-black border-t border-gray-800 z-30 flex justify-around p-2">
                <button
                    onClick={() => setActiveView('home')}
                    className={`flex flex-col items-center p-2 ${activeView === 'home' ? 'text-white' : 'text-gray-400'}`}
                >
                    <Home size={20} />
                    <span className="text-xs">Home</span>
                </button>
                <button
                    onClick={() => setActiveView('search')}
                    className={`flex flex-col items-center p-2 ${activeView === 'search' ? 'text-white' : 'text-gray-400'}`}
                >
                    <Search size={20} />
                    <span className="text-xs">Search</span>
                </button>
                <button
                    onClick={() => setActiveView('library')}
                    className={`flex flex-col items-center p-2 ${activeView === 'library' ? 'text-white' : 'text-gray-400'}`}
                >
                    <Library size={20} />
                    <span className="text-xs">Library</span>
                </button>
                <button
                    onClick={() => setActiveView('liked')}
                    className={`flex flex-col items-center p-2 ${activeView === 'liked' ? 'text-white' : 'text-gray-400'}`}
                >
                    <Heart size={20} className={activeView === 'liked' ? 'text-purple-500' : ''} />
                    <span className="text-xs">Liked</span>
                </button>
            </div>
          </div>
          );
        };

        // Render the component using the modern createRoot API
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MusicApp />);
    </script>
</body>
</html>
